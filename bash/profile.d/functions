#!/usr/bin/env bash

# ------------------------------------------------------------------
# md - create directory and enter it
# ------------------------------------------------------------------
function md() {
  local dir="$1"
  mkdir "$dir" && cd "${dir}" || return
}

# ------------------------------------------------------------------
# fshow - git commit browser (fzf)
# ------------------------------------------------------------------
# Modified version of junegunn's gist
# https://gist.github.com/junegunn/f3fca918e937e6bf5bad
# enter for show, ctrl-d for diff, ` toggles sort.
function fshow() {
  local output shas sha query key
  while output=$(
          git log --graph --color=always \
            --format="%C(auto)%h%d %s %C(black)%C(bold)%cr" "$@" |
          fzf --ansi --multi --no-sort --reverse --query="$query" \
            --print-query --expect=ctrl-d --toggle-sort=\`
        ); do
    query=$(head -1 <<< "$output")
    key=$(head -2 <<< "$output" | tail -1)
    shas=$(sed '1,2d;s/^[^a-z0-9]*//;/^$/d' <<< "$output" | awk '{print $1}')
    [ -z "$shas" ] && continue
    if [ "$key" = ctrl-d ]; then
      git diff --color=always "$shas" | $MANPAGER -R
    else
      for sha in $shas; do
        git show --color=always "$sha" | $MANPAGER -R
      done
    fi
  done
}

# ------------------------------------------------------------------
# 
# ------------------------------------------------------------------
