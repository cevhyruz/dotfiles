# vi:ft=tmux fdm=marker ---------------------------------------------------------------------------
# File:        tmux.conf
# Description: config file for tmux
# version:     >=tmux-3.2rc
# ---------------------------------------------------------------------------

# new tmux plugin manager.
source-file "~/Projects/dotfiles/tmux/lib/_lib.tmux"

# Tmux Options {{{1

set-option -g  prefix              `
set-option -g  prefix2             C-b

set-option -g  status-keys         vi
set-option -g  mode-keys           vi

set-option -g  mouse               on
set-option -g  monitor-activity    on
set-option -g  visual-activity     off
set-option -g  bell-action         none
set-option -g  visual-bell         off

set-option -g  automatic-rename    off
set-option -g  allow-rename        off

set-option -g  pane-base-index     1
set-option -g  base-index          1
set-option -g  aggressive-resize   on
set-option -g  renumber-windows    on
set-option -g  remain-on-exit      off
set-option -g  focus-events        on

set-option -g  set-titles          on
set-option -g  set-titles-string   "#S(#W:#P)"
set-option -g  default-command     "${SHELL}"
set-option -g  default-terminal    screen-256color

set-option -g  status-interval     15
set-option -g  escape-time         0
set-option -g  display-time        5000
set-option -g  repeat-time         4000
set-option -g  display-panes-time  5000
set-option -g  message-limit       10000
set-option -g  history-limit       20000

# Command Alias {{{1

set-option -s  @theme              "powerline"
set-option -sF @default-dir        "#{LIB:DOTFILES_DIR}"
set-option -s  @scroll-column      5

# Navigation {{{2

set-option -s command-alias[6] down='
if-shell "$IS_VIM || $IS_FZF" {
  if-shell -F "#{m/r:(copy|view)-mode,#{pane_mode}}" {
    select-pane -D
  } {
    send-keys C-j
  }
} { select-pane -D }'

set-option -g command-alias[7] up='
if-shell "$IS_VIM || $IS_FZF" {
   if-shell -F "#{m/r:(copy|view)-mode,#{pane_mode}}" {
       select-pane -U
   } {
    send-keys C-k
   }
} { select-pane -U }'

set-option -s command-alias[8] right='
if-shell "$IS_VIM" {
  if-shell -F "#{m/r:(copy|view)-mode,#{pane_mode}}" {
    select-pane -R
  } {
    send-keys C-l
  }
} { select-pane -R }'

set-option -s command-alias[9] left='
if-shell "$IS_VIM" {
  if-shell -F "#{m/r:(copy|view)-mode,#{pane_mode}}" {
    select-pane -L
  } {
    send-keys C-h
  }
} { select-pane -L }'

set-option -s command-alias[10] lastpane='
if-shell "$IS_VIM" {
  send-keys C-\\
} { last-pane } '

# Resizing {{{1

set-option -s command-alias[11]  _resize-pane-down='resize-pane -D 1'
set-option -s command-alias[12]    _resize-pane-up='resize-pane -U 1'
set-option -s command-alias[13] _resize-pane-right='resize-pane -R 1'
set-option -s command-alias[14]  _resize-pane-left='resize-pane -L 1'

set-option -s command-alias[32] term='
command-prompt -p "[${SHELL}]" {
  display-popup -KEER "%1"
}'

set-option -s command-alias[100] version='display "#{version}"'

# Miscellaneous

set-option -s command-alias[20] reload='
source-file -q "/etc/tmux.conf";
display-message " Config file reloaded";';

set-option -s command-alias[24] vsplit='split-window -h'

# Keybindings

# Root Table {{{1

bind-key -N "Navigate to the pane above (aliased: up) "       -n 'C-k' up
bind-key -N "Navigate to the pane below (aliased: down)"      -n 'C-j' down
bind-key -N "Navigate to the left pane (aliased: left)"       -n 'C-h' left
bind-key -N "Navigate to the right pane (aliased: right)"     -n 'C-l' right
bind-key -N "Go to the last visited pane (aliased: lastpane)" -n 'C-\' lastpane

# Prefix Table {{{1

bind -N "Reload tmux configuration file (aliased: reload)"   'r' reload
bind -N "Split window vertically (aliased: vsplit)"          '%' vsplit

bind -N "Adjust pane size by 1 column left (repeatable)"  -r 'H' _resize-pane-left
bind -N "Adjust pane size by 1 column down (repeatable)"  -r 'J' _resize-pane-down
bind -N "Adjust pane size by 1 column up (repeatable)"    -r 'K' _resize-pane-up
bind -N "Adjust pane size by 1 column right (repeatable)" -r 'L' _resize-pane-right

bind -N "Adjust pane size by 2 column left (repeatable)"  -r '<' resize-pane -L 2
bind -N "Adjust pane size by 2 column right (repeatable)" -r '>' resize-pane -R 2

bind -N "Start Visual mode" 'v' copy-mode

# set theme configurations, load new config into the statusbar
# and reformat the statusbar to reflect the new theme.
source-file -F "#{@LIB:TMUX_THEME}/powerline/powerline_theme.tmux"
source-file -F "#{@LIB:TMUX_LIB}/statusbar.tmux"
source-file -F "#{@LIB:TMUX_THEME}/powerline/powerline_format.tmux"

# load plugins.
source-file -F "#{@LIB:TMUX_PLUG}/**/*.tmux"
